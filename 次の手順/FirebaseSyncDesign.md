
# Firebase 同期機能 設計ガイド（準備用）

## 🎯 ゴール
ローカル完結の「スターバックス訪問履歴管理アプリ」に、Firebase を用いたクラウド同期機能（ログイン・バックアップ・復元）を追加できるよう準備する。

---

## ✅ 機能一覧（予定）

| 機能 | 説明 |
|------|------|
| ユーザーログイン | Google または メール＋パスワードでログイン |
| データ同期（保存） | ローカルデータを Firestore に保存 |
| データ同期（復元） | Firestore 上のデータをローカルに反映 |
| 同期ステータス表示 | 最終同期日時やログイン中のアカウント表示 |
| ログアウト | Firebase 認証からサインアウト |

---

## 🧱 Firebase 使用サービス

- **Authentication**
  - Google ログイン or メール＋パスワード
  - 利用者の識別に必要

- **Firestore**（推奨）
  - ドキュメント構造が柔軟で、訪問履歴データの構造に合致
  - Firestore セキュリティルールによりユーザーデータを保護可能

---

## 📦 Firestore データ構成案

```
users (コレクション)
 └─ {uid}（ドキュメント）
     ├─ lastBackup: timestamp
     ├─ stores (サブコレクション)
         └─ {storeId}（ドキュメント）
             ├─ name: string
             ├─ prefecture: string
             ├─ city: string
             ├─ ...
```

---

## 📁 ファイル構成（追加予定）

| ファイル名 | 役割 |
|------------|------|
| `firebase.js` | Firebase 初期化と基本関数（auth, firestore） |
| `authContext.js` | ログイン状態の管理とコンテキスト提供 |
| `storeSync.js` | ローカル ↔ Firestore の同期処理（バックアップ・復元） |
| `Settings.jsx` | 同期用の UI セクション追加（ログイン、同期、復元など） |

---

## 👤 認証UIの導線（想定）

- 設定画面の「クラウド同期」セクションに以下を配置
  - ✅ ログイン/ログアウトボタン（現在のアカウント名表示）
  - ☁️「クラウドへ保存」ボタン（Firestore へ書き込み）
  - ♻️「クラウドから復元」ボタン（Firestore から読み込み）

---

## ⚠️ 無料プランでの運用ポイント

- Firebase Sparkプラン（無料）は以下の範囲で利用可能：
  - 同時接続数：制限あり（通常使用には問題なし）
  - Firestore 書き込み数：約5万件/月（十分）
  - 認証：メール／Googleログイン含め無料
- 画像・ファイル保存は Firestore に直接保存可（Storageを使わず済む）

---

## 🔜 次ステップ（Firebase同期追加の流れ）

1. Firebase プロジェクトの作成
2. Authentication 設定（Googleログイン/メールパスワード）
3. Firestore の有効化とセキュリティルール設定
4. `firebase.js` の追加と初期化
5. ログイン処理の作成と UI 反映（`authContext.js`）
6. データ同期（アップロード・ダウンロード）関数の作成
7. 設定画面 UI に同期操作を組み込み
8. 動作確認とユーザー切り替えテスト

---

## 📌 備考

- Firestore はリアルタイム同期も可能だが、まずは**手動でのバックアップ・復元**で開始するのが安全
- JSON ⇔ Firestore間の整合性は `storeSync.js` にて変換関数で管理

---

## 📚 参考：使用予定ライブラリ

- firebase: `npm install firebase`
- react-firebase-hooks（必要に応じて）

---

## 📖 想定リリースフロー

- Ver.1.0.0：ローカル完結型
- Ver.1.1.0：Firebaseログイン＋同期機能を追加
- Ver.1.2.0：自動バックアップ、複数端末対応などを検討
